# base borrowed from https://stackoverflow.com/a/1080019
release ?= 1
ifeq ($(debug), 1)
    CFLAGS =-std=c++20 -Wall -pedantic -O2 -DPT
	LD=g++
else
    CFLAGS=-std=c++20 -Wall -pedantic -Werror -D_GLIBCXX_DEBUG -fsanitize=address -fsanitize=undefined -g -Og
# linker would otherwise scream at me
	LD=g++ -fsanitize=address -fsanitize=undefined
endif

# base borrowed from presentation slides
CXX=g++
OBJS= test.o CellPosition.o Expression.o ExpressionBuilder.o Spreadsheet.o AST.o

all: fitexcel.out
fitexcel.out: $(OBJS)
	$(LD) -o $@ $^ -L./parser/x86_64-linux-gnu/ -lexpression_parser
clean:
	rm -f fitexcel.out $(OBJS)
%.o: %.cpp
	$(CXX) $(CFLAGS) -c $<

%.o: src/%.cpp
	$(CXX) $(CFLAGS) -c $<

# generated by g++ -MM
test.o: test.cpp include/CellPosition.hpp include/Spreadsheet.hpp \
 include/Expression.hpp include/../parser/expression.h \
 include/ExpressionBuilder.hpp include/CellPosition.hpp include/AST.hpp
AST.o: src/AST.cpp src/../include/AST.hpp
CellPosition.o: src/CellPosition.cpp src/../include/CellPosition.hpp
ExpressionBuilder.o: src/ExpressionBuilder.cpp \
 src/../include/ExpressionBuilder.hpp \
 src/../include/../parser/expression.h src/../include/CellPosition.hpp \
 src/../include/AST.hpp src/../include/AST.hpp
Expression.o: src/Expression.cpp src/../include/Expression.hpp \
 src/../include/../parser/expression.h \
 src/../include/ExpressionBuilder.hpp src/../include/CellPosition.hpp \
 src/../include/AST.hpp src/../parser/expression.h \
 src/../include/ExpressionBuilder.hpp src/../include/AST.hpp
Spreadsheet.o: src/Spreadsheet.cpp src/../include/Spreadsheet.hpp \
 src/../include/Expression.hpp src/../include/../parser/expression.h \
 src/../include/ExpressionBuilder.hpp src/../include/CellPosition.hpp \
 src/../include/AST.hpp src/../include/CellPosition.hpp \
 src/../include/Expression.hpp



